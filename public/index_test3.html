<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>socket</title>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
	
	<!--<script src="libraries/p5.js"></script>-->
	<!--<script src="File_Dariush_mic.js"></script>
	<script src="libraries/p5.sound.js"></script>-->
	<!--<script src="libraries/p5.dom.js"></script>-->
	<script   src="https://code.jquery.com/jquery-3.4.1.js"   integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="   crossorigin="anonymous"></script>




    
    


	

	<style>
		body {
			margin:0;
			padding:0;
			overflow: hidden;
			font-family:"Helvetica";
			line-height:140%;
		}
		canvas {
			margin:auto;
		}
button{
	display: flex;
        position: fixed;
        top:1rem;
		left:1rem;
        font-family: inherit;
        font-size: 1rem;
        text-align: center;
        padding: 0.5rem 1rem;
        border:0;
        border-radius: 0.25rem;
		color:silver;
        background-color: black;
        box-shadow: 2px 2px 2px rgb(53, 50, 50);
        

}
	</style>
</head>
<body>
	<button  class="button"type="button" id="start">start</button>

	<canvas id="meter" width="500" height="500"></canvas>

</body>
<script>

   var audioCtx;
    var analyser;
    var bufferLength;
    var dataArray;
    var listen = 0;

    $(function() {
        $("#start").on("click", function(e) {
            e.preventDefault();
			console.log('click')
            //audioCtx = new(window.AudioContext || window.webkitAudioContext)();
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            analyser = audioCtx.createAnalyser();


// ...

            analyser.fftSize = 256;
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
           // analyser.getByteTimeDomainData(dataArray);

            analyser.getByteFrequencyData(dataArray);

            listen=1;

        });
    });



    function setup(){
        createCanvas(100,100);
        frameRate(10);
    }

    function draw(){
        clear();
        if(listen==1){
            console.log(dataArray)
            var barWidth = (width / bufferLength) * 2.5;
            var x = 0;
            var barHeight=0;
            for(var i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i];

                fill((barHeight+100),50,50);
                rect(x,height-barHeight/2,barWidth,barHeight/2);

                x += barWidth + 1;
            }
        }
    }


   /*var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
   var analyser = audioCtx.createAnalyser();

   var canvasCtx = document.getElementById( "meter" ).getContext("2d");

   analyser.fftSize = 256;
   var bufferLength = analyser.frequencyBinCount;
   console.log(bufferLength);
   var dataArray = new Uint8Array(bufferLength);

   var WIDTH = 500;
   var HEIGHT = 500;



   function draw() {
       canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);

       drawVisual = requestAnimationFrame(draw);

       analyser.getByteFrequencyData(dataArray);

       console.log(dataArray)

       canvasCtx.fillStyle = 'rgb(255, 255, 255)';
       canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);

       var barWidth = (WIDTH / bufferLength) * 2.5;
       var barHeight;
       var x = 0;

       for(var i = 0; i < bufferLength; i++) {
           barHeight = dataArray[i];

           canvasCtx.fillStyle = 'rgb(' + (barHeight+100) + ',50,50)';
           canvasCtx.fillRect(x,HEIGHT-barHeight/2,barWidth,barHeight/2);

           x += barWidth + 1;
       }
   };

   draw();*/
</script>

</html>
